# backend/api-gateway/pyproject.toml
[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry]
name = "goat-prediction-api-gateway"
version = "1.0.0"
description = "API Gateway for GOAT Prediction Ultimate - Advanced Sports Prediction Platform"
authors = ["GOAT Prediction Team <dev@goat-prediction.com>"]
license = "Proprietary"
readme = "README.md"
homepage = "https://goat-prediction.com"
repository = "https://github.com/goat-prediction/ultimate"
documentation = "https://docs.goat-prediction.com"
keywords = ["sports", "predictions", "betting", "ai", "machine-learning", "api-gateway"]

classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Financial and Insurance Industry",
    "Intended Audience :: Developers",
    "Topic :: Office/Business :: Financial :: Investment",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "License :: Other/Proprietary License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Operating System :: POSIX :: Linux",
    "Natural Language :: English",
    "Natural Language :: French",
]

[tool.poetry.dependencies]
python = ">=3.11,<3.13"

# Core dependencies
fastapi = "^0.104.1"
uvicorn = {extras = ["standard"], version = "^0.24.0"}
pydantic = {extras = ["email"], version = "^2.5.0"}
python-multipart = "^0.0.6"
python-jose = {extras = ["cryptography"], version = "^3.3.0"}
passlib = {extras = ["bcrypt"], version = "^1.7.4"}
cryptography = "^41.0.7"
python-dotenv = "^1.0.0"

# Database
asyncpg = "^0.29.0"
aioredis = "^2.0.1"
sqlalchemy = {extras = ["asyncio"], version = "^2.0.23"}
alembic = "^1.12.1"
psycopg2-binary = "^2.9.9"

# Monitoring & Observability
opentelemetry-api = "^1.21.0"
opentelemetry-sdk = "^1.21.0"
opentelemetry-exporter-otlp = "^1.21.0"
opentelemetry-instrumentation-fastapi = "^0.42b0"
opentelemetry-instrumentation-sqlalchemy = "^0.42b0"
prometheus-client = "^0.19.0"
structlog = "^23.2.0"

# Security
bcrypt = "^4.1.2"
pyjwt = "^2.8.0"
httpx = "^0.25.2"
fastapi-limiter = "^0.1.5"
slowapi = "^0.1.8"
python-json-logger = "^2.0.7"
email-validator = "^2.1.0"

# Rate limiting & Caching
redis = "^5.0.1"
cachetools = "^5.3.2"

# Utilities
click = "^8.1.7"
tenacity = "^8.2.3"
pytz = "^2023.3"
python-dateutil = "^2.8.2"
pyyaml = "^6.0.1"
orjson = "^3.9.10"
ujson = "^5.8.0"
rich = "^13.7.0"
tqdm = "^4.66.1"

# Testing dependencies (will be installed only for dev)
pytest = {version = "^7.4.3", optional = true}
pytest-asyncio = {version = "^0.21.1", optional = true}
pytest-cov = {version = "^4.1.0", optional = true}
pytest-xdist = {version = "^3.5.0", optional = true}
httpx = {version = "^0.25.2", optional = true}
pytest-httpx = {version = "^0.27.0", optional = true}
pytest-mock = {version = "^3.12.0", optional = true}
pytest-benchmark = {version = "^4.0.0", optional = true}
factory-boy = {version = "^3.3.0", optional = true}
freezegun = {version = "^1.2.2", optional = true}
respx = {version = "^0.20.2", optional = true}

# Development dependencies
pre-commit = {version = "^3.5.0", optional = true}
black = {version = "^23.12.1", optional = true}
isort = {version = "^5.13.2", optional = true}
flake8 = {version = "^6.1.0", optional = true}
mypy = {version = "^1.7.1", optional = true}
bandit = {version = "^1.7.6", optional = true}
safety = {version = "^2.3.5", optional = true}
pylint = {version = "^3.0.3", optional = true}
mypy = {version = "^1.7.1", optional = true}
autoflake = {version = "^2.2.1", optional = true}
pydocstyle = {version = "^6.3.0", optional = true}
types-python-dateutil = {version = "^2.8.19.14", optional = true}
types-redis = {version = "^4.6.0.10", optional = true}
types-pyyaml = {version = "^6.0.12.12", optional = true}
types-requests = {version = "^2.31.0.10", optional = true}
types-PyYAML = {version = "^6.0.12.20240106", optional = true}

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.3"
pytest-asyncio = "^0.21.1"
pytest-cov = "^4.1.0"
pytest-xdist = "^3.5.0"
pytest-httpx = "^0.27.0"
pytest-mock = "^3.12.0"
pytest-benchmark = "^4.0.0"
factory-boy = "^3.3.0"
freezegun = "^1.2.2"
respx = "^0.20.2"

# Code quality
pre-commit = "^3.5.0"
black = "^23.12.1"
isort = "^5.13.2"
flake8 = "^6.1.0"
flake8-bugbear = "^23.11.28"
flake8-comprehensions = "^3.14.0"
flake8-docstrings = "^1.7.0"
flake8-import-order = "^0.18.2"
mypy = "^1.7.1"
bandit = "^1.7.6"
safety = "^2.3.5"
pylint = "^3.0.3"
autoflake = "^2.2.1"
pydocstyle = "^6.3.0"

# Type stubs
types-python-dateutil = "^2.8.19.14"
types-redis = "^4.6.0.10"
types-pyyaml = "^6.0.12.12"
types-requests = "^2.31.0.10"

[tool.poetry.scripts]
api-gateway = "src.main:main"
migrate = "src.cli:migrate"
seed = "src.cli:seed"
create-user = "src.cli:create_user"
generate-jwt-secret = "src.cli:generate_jwt_secret"

[tool.black]
line-length = 88
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
    \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
  | migrations
)/
'''

[tool.isort]
profile = "black"
line_length = 88
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
known_first_party = ["src"]
known_third_party = [
    "fastapi", "uvicorn", "pydantic", "sqlalchemy", "asyncpg", "aioredis",
    "alembic", "pytest", "httpx", "redis", "structlog", "prometheus_client"
]

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
disallow_untyped_decorators = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_equality = true
exclude = [
    "^migrations/",
    "^alembic/",
    "^tests/fixtures/",
    "^\.venv/",
    "^build/",
    "^dist/"
]

[[tool.mypy.overrides]]
module = [
    "alembic.*",
    "tests.*",
    "src.tests.*"
]
disallow_untyped_defs = false

[tool.pylint.'MESSAGES CONTROL']
disable = [
    "missing-docstring",
    "too-few-public-methods",
    "import-error",
    "no-name-in-module",
    "invalid-name",
    "too-many-arguments",
    "too-many-locals",
    "too-many-branches",
    "too-many-statements",
    "too-many-instance-attributes",
    "protected-access",
    "duplicate-code"
]

[tool.pylint.'MASTER']
load-plugins = "pylint.extensions.mccabe"
jobs = 4

[tool.pylint.'FORMAT']
max-line-length = 88
single-line-if-stmt = false

[tool.pylint.'DESIGN']
max-args = 8
max-attributes = 15
max-locals = 20
max-returns = 6
max-branches = 15
max-statements = 50
max-parents = 7
max-public-methods = 20

[tool.pylint.'BASIC']
good-names = [
    "i", "j", "k", "ex", "Run", "_", "db", "id", "app", "e", "f", "g", "x", "y", "z",
    "n", "m", "t", "dt", "ts", "url", "env", "api", "req", "resp", "cfg", "msg", "err",
    "fn", "fp", "io", "obj", "val", "var", "idx", "len", "max", "min", "sum", "avg",
    "cnt", "num", "str", "int", "bool", "list", "dict", "set", "tuple", "bytes",
    "uuid", "json", "yaml", "xml", "csv", "txt", "bin", "hex", "oct", "dec"
]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "--strict-markers",
    "--strict-config",
    "--disable-warnings",
    "--tb=short",
    "-v",
    "--cov=src",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-report=xml"
]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "e2e: marks tests as end-to-end tests",
    "performance: marks tests as performance tests",
    "security: marks tests as security tests"
]
asyncio_mode = "auto"
filterwarnings = [
    "error",
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning"
]

[tool.coverage.run]
source = ["src"]
omit = [
    "*/tests/*",
    "*/migrations/*",
    "*/alembic/*",
    "*/__pycache__/*",
    "*/setup.py",
    "*/conftest.py"
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "if settings.DEBUG",
    "raise AssertionError",
    "raise NotImplementedError",
    "if 0:",
    "if __name__ == .__main__.:",
    "class .*\bProtocol\\):",
    "@(abc\\.)?abstractmethod"
]
fail_under = 85

[tool.bandit]
exclude_dirs = ["tests", "migrations", ".venv", "build", "dist"]
skips = ["B101", "B104", "B105", "B106", "B107", "B108", "B301", "B302", "B303", "B304", "B305", "B306", "B307", "B308", "B309", "B310", "B311", "B312", "B313", "B314", "B315", "B316", "B317", "B318", "B319", "B320", "B321", "B322", "B323", "B324", "B325", "B326", "B327", "B328", "B329", "B330", "B331", "B332", "B333", "B334", "B335", "B336", "B337", "B338", "B339", "B340", "B341", "B342", "B343", "B344", "B345", "B346", "B347", "B348", "B349", "B350", "B351", "B352", "B353", "B354", "B355", "B356", "B357", "B358", "B359", "B360", "B361", "B362", "B363", "B364", "B365", "B366", "B367", "B368", "B369", "B370", "B371", "B372", "B373", "B374", "B375", "B376", "B377", "B378", "B379", "B380", "B381", "B382", "B383", "B384", "B385", "B386", "B387", "B388", "B389", "B390", "B391", "B392", "B393", "B394", "B395", "B396", "B397", "B398", "B399", "B400", "B401", "B402", "B403", "B404", "B405", "B406", "B407", "B408", "B409", "B410", "B411", "B412", "B413", "B414", "B415", "B416", "B417", "B418", "B419", "B420", "B421", "B422", "B423", "B424", "B425", "B426", "B427", "B428", "B429", "B430", "B431", "B432", "B433", "B434", "B435", "B436", "B437", "B438", "B439", "B440", "B441", "B442", "B443", "B444", "B445", "B446", "B447", "B448", "B449", "B450", "B451", "B452", "B453", "B454", "B455", "B456", "B457", "B458", "B459", "B460", "B461", "B462", "B463", "B464", "B465", "B466", "B467", "B468", "B469", "B470", "B471", "B472", "B473", "B474", "B475", "B476", "B477", "B478", "B479", "B480", "B481", "B482", "B483", "B484", "B485", "B486", "B487", "B488", "B489", "B490", "B491", "B492", "B493", "B494", "B495", "B496", "B497", "B498", "B499", "B500", "B501", "B502", "B503", "B504", "B505", "B506", "B507", "B508", "B509", "B510", "B511", "B512", "B513", "B514", "B515", "B516", "B517", "B518", "B519", "B520", "B521", "B522", "B523", "B524", "B525", "B526", "B527", "B528", "B529", "B530", "B531", "B532", "B533", "B534", "B535", "B536", "B537", "B538", "B539", "B540", "B541", "B542", "B543", "B544", "B545", "B546", "B547", "B548", "B549", "B550", "B551", "B552", "B553", "B554", "B555", "B556", "B557", "B558", "B559", "B560", "B561", "B562", "B563", "B564", "B565", "B566", "B567", "B568", "B569", "B570", "B571", "B572", "B573", "B574", "B575", "B576", "B577", "B578", "B579", "B580", "B581", "B582", "B583", "B584", "B585", "B586", "B587", "B588", "B589", "B590", "B591", "B592", "B593", "B594", "B595", "B596", "B597", "B598", "B599", "B600", "B601", "B602", "B603", "B604", "B605", "B606", "B607", "B608", "B609", "B610", "B611", "B612", "B613", "B614", "B615", "B616", "B617", "B618", "B619", "B620", "B621", "B622", "B623", "B624", "B625", "B626", "B627", "B628", "B629", "B630", "B631", "B632", "B633", "B634", "B635", "B636", "B637", "B638", "B639", "B640", "B641", "B642", "B643", "B644", "B645", "B646", "B647", "B648", "B649", "B650", "B651", "B652", "B653", "B654", "B655", "B656", "B657", "B658", "B659", "B660", "B661", "B662", "B663", "B664", "B665", "B666", "B667", "B668", "B669", "B670", "B671", "B672", "B673", "B674", "B675", "B676", "B677", "B678", "B679", "B680", "B681", "B682", "B683", "B684", "B685", "B686", "B687", "B688", "B689", "B690", "B691", "B692", "B693", "B694", "B695", "B696", "B697", "B698", "B699", "B700", "B701", "B702", "B703", "B704", "B705", "B706", "B707", "B708", "B709", "B710", "B711", "B712", "B713", "B714", "B715", "B716", "B717", "B718", "B719", "B720", "B721", "B722", "B723", "B724", "B725", "B726", "B727", "B728", "B729", "B730", "B731", "B732", "B733", "B734", "B735", "B736", "B737", "B738", "B739", "B740", "B741", "B742", "B743", "B744", "B745", "B746", "B747", "B748", "B749", "B750", "B751", "B752", "B753", "B754", "B755", "B756", "B757", "B758", "B759", "B760", "B761", "B762", "B763", "B764", "B765", "B766", "B767", "B768", "B769", "B770", "B771", "B772", "B773", "B774", "B775", "B776", "B777", "B778", "B779", "B780", "B781", "B782", "B783", "B784", "B785", "B786", "B787", "B788", "B789", "B790", "B791", "B792", "B793", "B794", "B795", "B796", "B797", "B798", "B799", "B800", "B801", "B802", "B803", "B804", "B805", "B806", "B807", "B808", "B809", "B810", "B811", "B812", "B813", "B814", "B815", "B816", "B817", "B818", "B819", "B820", "B821", "B822", "B823", "B824", "B825", "B826", "B827", "B828", "B829", "B830", "B831", "B832", "B833", "B834", "B835", "B836", "B837", "B838", "B839", "B840", "B841", "B842", "B843", "B844", "B845", "B846", "B847", "B848", "B849", "B850", "B851", "B852", "B853", "B854", "B855", "B856", "B857", "B858", "B859", "B860", "B861", "B862", "B863", "B864", "B865", "B866", "B867", "B868", "B869", "B870", "B871", "B872", "B873", "B874", "B875", "B876", "B877", "B878", "B879", "B880", "B881", "B882", "B883", "B884", "B885", "B886", "B887", "B888", "B889", "B890", "B891", "B892", "B893", "B894", "B895", "B896", "B897", "B898", "B899", "B900", "B901", "B902", "B903", "B904", "B905", "B906", "B907", "B908", "B909", "B910", "B911", "B912", "B913", "B914", "B915", "B916", "B917", "B918", "B919", "B920", "B921", "B922", "B923", "B924", "B925", "B926", "B927", "B928", "B929", "B930", "B931", "B932", "B933", "B934", "B935", "B936", "B937", "B938", "B939", "B940", "B941", "B942", "B943", "B944", "B945", "B946", "B947", "B948", "B949", "B950", "B951", "B952", "B953", "B954", "B955", "B956", "B957", "B958", "B959", "B960", "B961", "B962", "B963", "B964", "B965", "B966", "B967", "B968", "B969", "B970", "B971", "B972", "B973", "B974", "B975", "B976", "B977", "B978", "B979", "B980", "B981", "B982", "B983", "B984", "B985", "B986", "B987", "B988", "B989", "B990", "B991", "B992", "B993", "B994", "B995", "B996", "B997", "B998", "B999"
]

[tool.safety]
# Security configuration for dependency scanning
output = "json"
ignore = [
    "51457",  # pytz (CVE-2023-46117) - false positive for our usage
    "51668",  # cryptography (CVE-2023-50782) - patched in our version
]

[tool.commitizen]
name = "cz_conventional_commits"
version = "1.0.0"
tag_format = "v$version"
version_files = [
    "pyproject.toml:version",
    "src/__init__.py"
]
update_changelog_on_bump = true
changelog_file = "CHANGELOG.md"
changelog_format = "conventional"
changelog_incremental = true
major_version_zero = true

[tool.setup.cfg]
# Additional setup.cfg style configuration for compatibility
[metadata]
license_files = ["LICENSE", "LICENSE.txt"]

[tool.ruff]
# Configuration for Ruff linter (alternative to flake8)
target-version = "py311"
line-length = 88
select = [
    "E",  # pycodestyle errors
    "W",  # pycodestyle warnings
    "F",  # pyflakes
    "I",  # isort
    "B",  # flake8-bugbear
    "C4", # flake8-comprehensions
    "UP", # pyupgrade
    "YTT", # flake8-2020
]
ignore = [
    "E501",  # line too long, handled by black
    "B008",  # do not perform function calls in argument defaults
    "C901",  # too complex
]
exclude = [
    ".git",
    "__pycache__",
    ".venv",
    "env",
    "venv",
    "migrations",
    "alembic",
    "dist",
    "build",
]
per-file-ignores = {}
fixable = ["ALL"]
unfixable = []

[tool.ruff.isort]
known-first-party = ["src"]

[tool.ruff.mccabe]
max-complexity = 10

[project.urls]
Homepage = "https://goat-prediction.com"
Documentation = "https://docs.goat-prediction.com"
Repository = "https://github.com/goat-prediction/ultimate"
Changelog = "https://github.com/goat-prediction/ultimate/blob/main/CHANGELOG.md"
Issues = "https://github.com/goat-prediction/ultimate/issues"
Support = "https://goat-prediction.com/support"

[project.optional-dependencies]
dev = [
    "pytest>=7.4.3",
    "pytest-asyncio>=0.21.1",
    "pytest-cov>=4.1.0",
    "pytest-xdist>=3.5.0",
    "pytest-httpx>=0.27.0",
    "pytest-mock>=3.12.0",
    "pytest-benchmark>=4.0.0",
    "factory-boy>=3.3.0",
    "freezegun>=1.2.2",
    "respx>=0.20.2",
    "pre-commit>=3.5.0",
    "black>=23.12.1",
    "isort>=5.13.2",
    "flake8>=6.1.0",
    "flake8-bugbear>=23.11.28",
    "flake8-comprehensions>=3.14.0",
    "flake8-docstrings>=1.7.0",
    "flake8-import-order>=0.18.2",
    "mypy>=1.7.1",
    "bandit>=1.7.6",
    "safety>=2.3.5",
    "pylint>=3.0.3",
    "autoflake>=2.2.1",
    "pydocstyle>=6.3.0",
    "types-python-dateutil>=2.8.19.14",
    "types-redis>=4.6.0.10",
    "types-pyyaml>=6.0.12.12",
    "types-requests>=2.31.0.10",
]

testing = [
    "pytest>=7.4.3",
    "pytest-asyncio>=0.21.1",
    "pytest-cov>=4.1.0",
    "pytest-xdist>=3.5.0",
    "pytest-httpx>=0.27.0",
    "pytest-mock>=3.12.0",
    "pytest-benchmark>=4.0.0",
    "factory-boy>=3.3.0",
    "freezegun>=1.2.2",
    "respx>=0.20.2",
]

docs = [
    "mkdocs>=1.5.3",
    "mkdocs-material>=9.5.3",
    "mkdocstrings[python]>=0.24.0",
    "mkdocs-autorefs>=0.5.0",
    "mkdocs-minify-plugin>=0.7.0",
]

performance = [
    "locust>=2.20.0",
    "k6>=0.0.0",
    "vegeta>=12.8.4",
]
